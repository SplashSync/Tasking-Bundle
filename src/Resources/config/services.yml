imports:
    - { resource: services/admin.yml }
    - { resource: services/commands.yml }
    
services:
    
    ########################################################################
    #   TASKING BUNDLE LOW LEVEL SERVICES
    ########################################################################

    ########################################################################
    # Tasks Management Service
    splash.tasking.runner:
        class: Splash\Tasking\Services\Runner
        public:     true        
        arguments:
            - "@service_container"
            - "@logger"
            - "@doctrine"
            - "@splash.tasking.tokens"
            - "%splash_tasking%"
        tags:
            - { name: monolog.logger, channel: Tasking }

    ########################################################################
    # Tasks Management Service
    splash.tasking.tasks:
        class: Splash\Tasking\Services\TasksManager
        public:     true        
        arguments:
            - "@doctrine"
            - "@event_dispatcher"
            - "@logger"
            - "@splash.tasking.tokens"
            - "%splash_tasking%"
        tags:
            - { name: kernel.event_listener, event: Splash\Tasking\Events\AddEvent, method: onAddAction }
            - { name: kernel.event_listener, event: Splash\Tasking\Events\InsertEvent, method: onAddAction }
            - { name: monolog.logger, channel: Tasking }

    ########################################################################
    # Supervisor Management Service
    splash.tasking.supervisors:
        class: Splash\Tasking\Services\SupervisorsManager
        public:     true        
        arguments:
            - "@doctrine"
            - "@logger"
            - "@splash.tasking.process"
            - "%splash_tasking%"
        tags:
            - { name: kernel.event_listener, event: Splash\Tasking\Events\CheckEvent, method: checkSupervisor }
            - { name: kernel.event_listener, event: Splash\Tasking\Events\AddEvent, method: checkSupervisor }
            - { name: monolog.logger, channel: Tasking }

    ########################################################################
    # Workers Management Service
    splash.tasking.workers:
        class: Splash\Tasking\Services\WorkersManager
        public:     true        
        arguments:
            - "@doctrine"
            - "@logger"
            - "@splash.tasking.process"
            - "%splash_tasking%"
        tags:
            - { name: monolog.logger, channel: Tasking }

    ########################################################################
    # Tokens Management Service
    splash.tasking.tokens:
        class: Splash\Tasking\Services\TokenManager
        public:     true        
        arguments:
            - "@doctrine"
            - "@logger"
            - "%splash_tasking%"
        tags:
            - { name: monolog.logger, channel: Tasking }

    ########################################################################
    # Process Management Service
    splash.tasking.process:
        class: Splash\Tasking\Services\ProcessManager
        public:     true        
        arguments:
            - "@logger"
            - "%kernel.root_dir%"
            - "%splash_tasking%"
        tags:
            - { name: kernel.event_listener, event: Splash\Tasking\Events\AddEvent, method: checkCrontab }
            - { name: monolog.logger, channel: Tasking }

    